<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>品牌管理</title>
    <link rel="stylesheet" href="../css/elementui.css">
    <style>
          .avatar-uploader .el-upload {
    border: 1px dashed #d9d9d9;
    border-radius: 6px;
    cursor: pointer;
    position: relative;
    overflow: hidden;
  }
  .avatar-uploader .el-upload:hover {
    border-color: #409EFF;
  }
  .avatar-uploader-icon {
    font-size: 28px;
    color: #8c939d;
    width: 178px;
    height: 178px;
    line-height: 178px;
    text-align: center;
  }
  .avatar {
    width: 178px;
    height: 178px;
    display: block;
  }
    </style>


</head>
<body>
<div id="app">
    <el-form :inline="true" :model="searchMap" class="demo-form-inline">
        <el-form-item label="名称">
          <el-input v-model="searchMap.name" ></el-input>
        </el-form-item>
        <el-form-item label="首字母">
            <el-input v-model="searchMap.letter" ></el-input>
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="paging">查询</el-button>
        </el-form-item>
        <el-form-item>
            <el-button type="primary" @click="dialogFormVisible = true">新增</el-button>
          </el-form-item>
      </el-form>
    <el-table
    :data="tableData"
    style="width: 100%">
    <el-table-column
      prop="id"
      label="ID"
      width="180">
    </el-table-column>
    <el-table-column
      prop="name"
      label="名称"
      width="180">
    </el-table-column>
    <el-table-column
      prop="letter"
      label="首字母">
    </el-table-column>
    <el-table-column
    label="图片">
    <template slot-scope="scope">
        <img width="100px" height="50px" :src="scope.row.image">
    </template>
  </el-table-column>
  <el-table-column
  label="操作"
  width="180">
<template slot-scope="scope">
  <el-button type="text" @click="edit(scope.row.id)" size="small">修改</el-button>
  <el-button type="text" @click="dele(scope.row.id)" size="small">删除</el-button>
</template>

</el-table-column>
  </el-table>

  <el-pagination
  background=true
  @size-change="handleSizeChange"
  @current-change="handleCurrentChange"
  :current-page="page"
  :page-sizes="[5, 10, 20]"
  :page-size="100"
  layout="total, sizes, prev, pager, next, jumper"
  :total="total">
</el-pagination>
<!--新增-->
<el-dialog title="新增" :visible.sync="dialogFormVisible">
    <el-form :model="pojo">
      <el-form-item label="名称" :label-width="formLabelWidth">
        <el-input v-model="pojo.name" auto-complete="off"></el-input>
      </el-form-item>
      <el-form-item label="首字母" :label-width="formLabelWidth">
        <el-input v-model="pojo.letter" auto-complete="off"></el-input>
      </el-form-item>
    </el-form>
    <el-upload
  class="avatar-uploader"
  action="https://jsonplaceholder.typicode.com/posts/"
  :show-file-list="false"
  :on-success="handleAvatarSuccess"
  :before-upload="beforeAvatarUpload">
  <img v-if="pojo.image" :src="pojo.image" class="avatar">
  <i v-else class="el-icon-plus avatar-uploader-icon"></i>
</el-upload>
    <div slot="footer" class="dialog-footer">
      <el-button @click="dialogFormVisible = false">取 消</el-button>
      <el-button type="primary" @click="save()">保 存</el-button>
    </div>
  </el-dialog>


</div>

</body>
<script src="../js/vue.js"></script>
<script src="../js/elementui.js"></script>
<script src="../js/axios.js"></script>

<script>
    new Vue({
        el:"#app",
        data(){
            return {
                imageUrl: '',
                dialogFormVisible: false,
                tableData: [],
                page:1,
                size:10,
                total: "",
                searchMap: {
                    name: "",
                    letter: ""

                },
                pojo: {
                    id: "",
                    name: "",
                    letter: "",
                    image: "",
                    seq: ""
                    

                }
                
            }

        },
        methods: {
            handleAvatarSuccess(res, file) {
        this.imageUrl = file.response;
      },
      beforeAvatarUpload(file) {
        const isJPG = file.type === 'image/jpeg';
        const isLt2M = file.size / 1024 / 1024 < 2;

        if (!isJPG) {
          this.$message.error('上传头像图片只能是 JPG 格式!');
        }
        if (!isLt2M) {
          this.$message.error('上传头像图片大小不能超过 2MB!');
        }
        return isJPG && isLt2M;
      },
      handleSizeChange(val) {
        this.size=val;
        this.paging();
      },
      handleCurrentChange(val) {
       this.page=val;
       this.paging();
      },
      paging(){
        axios.post("/brand/findPage.do"+"?page="+this.page+"&size="+this.size,this.searchMap).then(res=>{
               this.total=res.data.total;
               this.tableData=res.data.rows;
            })

      },
      save(){
        if(this.pojo.id==="")
        axios.post("/brand/add.do",this.pojo).then(res=>{
        const h = this.$createElement;
        this.$notify({
          title: '',
          message: h('i', { style: 'color: teal'}, res.data.message)
        });
        this.dialogFormVisible = false
        })
        else
        axios.put("/brand/update.do",this.pojo).then(res=>{
        const h = this.$createElement;
        this.$notify({
          title: '',
          message: h('i', { style: 'color: teal'}, res.data.message)
        });
        this.dialogFormVisible = false
        })
        this.paging();


      },
      dele(id){
        axios.delete("/brand/delete.do"+"?id="+id).then(res=>{
        const h = this.$createElement;
        this.$notify({
          title: '',
          message: h('i', { style: 'color: teal'}, res.data.message)
        });
        this.paging();
        })

      },
      edit(id){
        axios.get("/brand/findById.do"+"?id="+id).then(res=>{
            this.pojo=res.data
        })

        this.dialogFormVisible = true
      }

        },
        
        created(){
            this.paging()

        }
        
    })




</script>

</html>